name: Set Up Cumulus
description: 'Install CumulusCI and sfdx'
inputs:
  cumulusci-version:
    description: 'version of CumulusCI to install'
    required: true
    default: 'latest'
  sfdx-version:
    description: 'version of SFDX to install'
    required: true
    default: 'latest'
runs:
    using: "composite"
    steps:
      - name: Store Versions
        run: |
          sfdx version > actions-sfdx-version.txt
          cci version > actions-cci-version.txt
        shell: bash
      - name: Set Up Node 
        uses: actions/setup-node@v3
        with:
          node-version: 16
          cache: npm
          cache-dependency-path: actions-sfdx-version.txt
      - name: Install sfdx
        run: |
          npm install -g 'sfdx-cli@${{ inputs.sfdx-version }}'
        shell: bash
      - name: Set Up Python
        uses: actions/setup-python@v3
        with:
          python-version: "3.10"
          cache: pip
          cache-dependency-path: actions-cci-version.txt
      - name: Install CumulusCI
        run: |
          if [ '${{ inputs.cumulusci-version }}' == 'latest' ]; then
            VERSION=''
          else
            VERSION='==${{ inputs.cumulusci-version }}'
          fi

          pip install "cumulusci$VERSION"
        shell: bash
